$Id: README,v 1.23 2010-09-24 08:18:45 oops Exp $

libkrisp - Korea ISP library

작성: 김정균 2010.05.22 http://oops.org


자세한 내용은 http://devel.oops.org/ 의 libkrisp section 을 참고하기 바란다.

libkrisp 는 한국의 ip address 에 대한 ISP 정보를 얻기 위한 라이브러리이다. 이
library 를 사용하기 위해서는 sqlite library 가 필요하며, sqlite2 또는 sqlite3
이 필요하다. sqlite2 와 sqlite3 이 동시에 설치가 되어 있으면, sqlite3 을 이용
하며, sqlite3 을 사용하는 것을 권장한다. (sqlite2 는 가끔 오동작을 한다.)

간단한 사용법은 아래와 같다. (자세한 사항은 'man 3 kr_search' 를 참고한다.)


#include <krisp.h>

int main (void) {
    KR_API * db;
    KRNET_API isp;
    //char * ip = "168.126.63.1";
    char * ip = "kns.kornet.net";
    int r;
    char * database = NULL;
    char err[1024];

    if ( kr_open (&db, database, err)) == false ) {
        fprintf (stderr, "ERROR Connect: %s\n", err);
        return 1;
    }

	isp.verbose = false;
    // defined SAFECPY_256 in krispapi.h
    SAFECPY_256 (isp.ip, addr);
    if ( kr_search (&isp, db) ) {
        printf ("ERROR: %s\n", isp.err);
        kr_close (&db);
        return 1;
    }

    kr_close (&db);

    /*
     * kr_long2ip is returned in a statically allocated buffer, which
     * subsequent calls will overwrite.
     */
    printf ("%-15s %-15s %-20s", ip, isp.ip, isp.icode);
    printf ("%-15s ", kr_long2ip (isp.start));
    printf ("%-15s %s", kr_long2ip (isp.end), isp.iname);

    return 0;
}


libkrisp 3.1 부터는 database 의 변경 사항을 감시하는 기능이 추가가 되었다. 기
본적으로는 체크를 하지 않으며, open 후에 KR_API의 db_time_stamp_interval 값을
지정하면, 지정한 초 마다 database의 mtime을 검사하여 open시의 값과 틀릴 경우,
DB 핸들을 닫았다가 다시 열게 된다. 검사 간격을 조정하고 싶다면 다음과 같이 코
드를 작성할 수 있다.

    if ( kr_open (&db, database, err)) == false ) {
        fprintf (stderr, "ERROR Connect: %s\n", err);
        return 1;
    }

    // increased database mtime check interval to 1d.
    // default is 0 seconds (Don't check).
    db->db_time_stamp_interval = 86400;


